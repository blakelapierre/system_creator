<html>
  <head>
    <title>TRUMPorbit</title>

    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@TRUMPorbit" />
    <meta name="twitter:title" content="TRUMPorbit" />
    <meta name="twitter:description" content="enter TRUMP orbit" />
    <meta name="twitter:image" content="https://blakelapierre.github.io/trumporbit/images/image.png" />
    <meta name="og:image" content="https://blakelapierre.github.io/trumporbit/images/image.png" />

    <script>less = {async: true}; //wot</script>

    <style type="text/less">
    body {
      height: 100%;

      margin: 0;
      padding: 0;

      display: flex;

      overflow: hidden;

      font-family: monospace;
    }

    textarea.link-box {
      display: none;
      position: fixed;

      top: 25%;
      left: 12.5%;
      width: 75%;
      height: 50%;

      margin: 0 auto;

      background-color: #fff;
      color: #000;

      &.show {
        display: block;
      }
    }

    hud {
      position: fixed;
      top: 0;
      left: 0;
      right: 100%;
      bottom: 100%;

      z-index: 1;

      color: rgba(255, 255, 255, 0.5);

      white-space: pre;

      transition: color 2s ease-in-out;

      &:hover {
        color: rgba(255, 255, 255, 1);
      }

      trump-mass {
        position: fixed;

        display: inline-block;

        top: 0;
        left: 0;

        margin: 1vw;
      }

      orbit-statistics {
        position: fixed;

        display: inline-block;

        bottom: 0;
        right: 0;

        margin: 1vw;
      }

      catch-up {
        position: fixed;

        bottom: 45%;
        width: 100%;

        font-size: 2vw;

        text-align: center;

        color: #ddd;

        text-shadow: 0px 0px 1em #000;
      }

      @keyframes fade-and-hide {
        0% {
          opacity: 1;
          // display: block;
        }
        100% {
          opacity: 0;
          // display: none;
        }
      }

      @keyframes flash-fade-and-hide {
        0% {
          text-shadow: 0px 0px 1em #fff;
          opacity: 1;
          // display: block;
        }
        10% {
          text-shadow: 0px 0px 0px #fff;
          opacity: 1;
        }
        100% {
          opacity: 0;
          text-shadow: none;
          // display: none;
        }
      }

      trump-tweet {
        display: none;

        position: fixed;

        top: 20%;
        width: 100%;

        font-size: 2em;

        text-align: center;

        color: #fff;

        opacity: 0;

        white-space: normal;

        &.show {
          display: block;

          animation: fade-and-hide 15s ease-in-out forwards;

          warning {
            animation: fade-and-hide 7s ease-in-out forwards;
          }

          info {
            animation: fade-and-hide 11s 1.5s ease-in-out forwards;
          }
        }

        info {
          display: block;

          margin-top: 1em;

          opacity: 0;
        }
      }

      absorbed {
        display: none;

        position: fixed;

        bottom: 20%;
        width: 100%;

        text-align: center;

        font-size: 1.5vw;

        color: #fff;

        opacity: 0;

        white-space: normal;

        &.show {
          display: block;

          animation: flash-fade-and-hide 4s ease-in-out forwards;
        }
      }

      commands {
        position: fixed;
        left: 0;
        bottom: 1vw;

        margin: 1vw;

        height: 0;
        width: 0;

        display: flex;
        flex-wrap: wrap;

        justify-content: space-between;
        align-items: center;

        border: solid 0px rgba(0, 0, 0, 0.7);

        overflow: hidden;

        transition: all 0.4s ease-in-out;

        &.show {
          height: 30vh;
          width: 90vw;

          border: solid 1px rgba(128, 128, 128, 0.4);
        }

        button {
          flex: 1 1 auto;

          padding: 0.5em;
          margin: 0 0.1em;

          font-size: 2em;

          background-color: rgba(128, 128, 128, 0.1);

          border: solid 1px rgba(128, 128, 128, 0.5);
          border: none;

          color: #fff;
        }
      }

      current-look-at {
        position: fixed;

        top: 0;
        left: 0;
        right: 0;

        white-space: normal;

        display: flex;

        justify-content: center;
        align-items: center;

        &.is-trump {
          table {
            display: none;
          }
        }

        previous-look-at, next-look-at {
          margin: 0 1.5vw;

          padding: 0 1vw;

          font-size: 3em;
          font-weight: bold;

          color: rgba(255, 255, 255, 0.1);

          cursor: pointer;

          user-select: none;
          -webkit-user-select: none;

          &:hover {
            color: rgba(255, 255, 255, 0.5);
            text-shadow: 0px 0px 1rem rgba(255, 255, 255, 0.7);
          }
        }

        display {
          min-width: 20%;

          display: flex;
          flex-direction: column;

          align-items: center;

          font-size: 0.8em;

          color: rgba(255, 255, 255, 0.7);

          table {
            font-size: 1em;

            color: rgba(255, 255, 255, 0.5);

            border-top: solid 1px rgba(255, 255, 255, 0.2);
          }

          mass-name {
            // font-size: 1rem;
            font-weight: bold;
          }

          distance {
            display: block;
          }
        }
      }

      current-mass {
        position: fixed;

        bottom: 0;
        left: 0;

        margin: 1vw;

        white-space: normal;

        display: flex;

        justify-content: center;
        align-items: center;

        previous-mass, next-mass {
          margin: 0 1.5vw;

          padding: 0 1vw;

          font-size: 5em;
          font-weight: bold;

          color: rgba(255, 255, 255, 0.7);

          cursor: pointer;

          &:hover {
            text-shadow: 0px 0px 1rem rgba(255, 255, 255, 0.7);
          }
        }

        display {
          min-width: 20%;

          display: flex;
          flex-direction: column;

          align-items: center;

          table {
            color: inherit;
          }

          mass-name {
            font-size: 1.2em;
            font-weight: bold;
          }

          distance {
            display: block;
          }
        }
      }

      tag {
        position: fixed;

        bottom: 0;
        left: 0;

        font-size: 0.4em;

        color: rgba(255, 255, 255, 0.5);

        cursor: default;

        user-select: none;
        -webkit-user-select: none;

        &:hover {
          text-shadow: 0px 0px 1em rgba(255, 215, 0, 0.5);
        }
      }

      @keyframes glow {
        0% {
          color: rgba(255, 255, 255, 0.5);
        }
        50% {
          color: rgba(255, 255, 255, 1);
        }
        100% {
          color: rgba(255, 255, 255, 0.5);
        }
      }

      help {
        position: fixed;

        right: 0;
        top: 0;

        margin: 1vw;

        font-size: 2em;

        cursor: pointer;

        animation: glow 20s 30s ease-in-out infinite;
      }

      help-content {
        display: none;

        &.show {
          display: block;
        }
      }
    }

    trump {
      text-shadow: 2px 2px 2px rgba(0, 0, 0, 1);
      color: rgba(255, 215, 0, 1);
    }

    // mathbox {
      @keyframes fade-color-out {
        0% {
          // color: rgba(255, 255, 255, 1);
          transform: scale(1);
        }
        100% {
          color: rgba(255, 215, 0, 0);
          text-shadow: 2px 2px 2px rgba(0, 0, 0, 0);
          transform: scale(1);
        }
      }

      @keyframes fade-color-in-and-out {
        0% {
          color: rgba(255, 255, 255, 0);
        }
        50% {
          color: rgba(255, 255, 255, 1);
        }
        100% {
          color: rgba(255, 255, 255, 0);
        }
      }

      @keyframes fade-background-out {
        0% {
          background-color: rgba(0, 0, 0, 1);
          transform: scale(1);
        }
        100% {
          background-color: rgba(0, 0, 0, 0);
          transform: scale(1);
        }
      }

      notice {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;

        font-size: 5vw;

        z-index: 2;

        transform: scale(0);

        animation: fade-color-out 11s ease-in-out;

        user-select: none;

        &.no-intro {
          display: none;
        }

        screen {
          position: absolute;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;

          background-color: rgba(0, 0, 0, 1);

          animation: fade-background-out 6s 3s ease-in-out forwards;
        }

        message {
          position: absolute;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;

          display: flex;

          color: rgba(255, 255, 255, 1);

          animation: fade-color-out 6s 1s ease-in-out forwards;

          align-items: center;
          justify-content: center;

          trump {
            margin: 0 1vw;
            font-size: 7vw;

            animation: fade-color-out 6s 3s ease-in-out forwards;
          }
        }

        statement {
          position: absolute;

          left: 0;
          right: 0;
          bottom: 10%;

          display: flex;

          font-size: 2vw;

          color: rgba(255, 255, 255, 0);

          animation: fade-color-in-and-out 6s 2s ease-in-out;

          align-items: center;
          justify-content: center;
        }
      }
    // }

    mathbox {
      display: flex;

      flex: 1 1 auto;

      height: 100%;

      &.has-editor-panel {
        mathbox-container {
          width: 50%;
        }
      }

      mathbox-container {
        width: 100%;
      }

      panel {
        display: flex;

        flex: 1 1 auto;

        // min-width: 50%;

        history {
          flex: 0 1 auto;

          background-color: white;
          color: black;

          overflow-y: auto;

          history-element {
            display: flex;
            flex-direction: column;

            cursor: pointer;

            &.had-error {
              background-color: red;
            }

            &:hover {
              background-color: #999;
            }

            info {
              display: block;
              text-align: center;
            }

            render-surface {
              display: block;

              overflow: hidden;

              transform: scale(0.9);

              white-space: pre-wrap;
              font-family: monospace;

              font-size: 0.5em;

              img {
                width: 100%;
              }
            }
          }
        }

        edit-panel {
          flex: 1 1 auto;

          display: flex;
          flex-direction: column;

          overflow: auto;

          &.after {
            order: 1;
          }

          &.has-error {
            error-area {
              display: block;

            }
          }

          textarea {
            flex: 1 1 auto;

            min-height: 2em;

            background: #000;

            border: none;

            color: #fff;

            white-space: pre-wrap;
            font-family: monospace;

            overflow: visible;

            cursor: text;

            transition: all 0.25s ease-in-out;
          }

          error-area {
            display: none;

            flex: 0 0 auto;

            width: 100%;

            overflow: auto;

            white-space: pre-wrap;
            font-family: monospace;

            background-color: #cc6666;

            transition: all 0.25s ease-in-out;
          }

          diff-area {
            * {
              display: none;

              white-space: pre-wrap;
            }

            ins {
              display: inline;
              color: green;
            }

            del {
              display: inline;
              color: red;
            }
          }
        }
      }
    }
    </style>
  </head>
  <body>
    <script src="dist/handler.min.js"></script>
    <script src="lib/mathbox-bundle.min.js"></script>

    <mathbox tabindex="2">
      <script type="mathbox/jsx">
        const trumpColors = [[[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0]],
        [[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0],[1.00392,0.83137,0.8,1],[1.24706,0.97255,0.76078,1],[1.40392,1.11373,0.78431,1],[1.4902,1.21569,0.87059,1],[1.52941,1.26275,0.94118,1],[1.41961,1.19216,0.91765,1],[1.40392,1.21569,0.98039,1],[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0]],
        [[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0],[0.94118,0.75294,0.77647,1],[1.30196,0.94118,0.61961,1],[1.41961,1.01961,0.63529,1],[1.41961,1.08235,0.73725,1],[1.41961,1.1451,0.80784,1],[1.45098,1.20784,0.91765,1],[1.4902,1.28627,1.01961,1],[1.48235,1.26275,0.98824,1],[1.47451,1.21569,0.92549,1],[1.43529,1.19216,0.88627,1],[1.46667,1.26275,0.97255,1],[1.48235,1.30196,1.05098,1],[1.34118,1.2549,1.17647,1],[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0]],
        [[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0],[1.22353,0.86275,0.57255,1],[1.35686,0.94902,0.58039,1],[1.36471,0.95686,0.61176,1],[1.40392,1.03529,0.69804,1],[1.38824,1.10588,0.79216,1],[1.41176,1.17647,0.87843,1],[1.44314,1.19216,0.92549,1],[1.41961,1.16863,0.90196,1],[1.41961,1.11373,0.80784,1],[1.40392,1.06667,0.75294,1],[1.35686,1.06667,0.75294,1],[1.32549,1.01176,0.6902,1],[1.35686,1.0902,0.80784,1],[1.44314,1.23137,1.01961,1],[1.23137,1.09804,1.05098,1],[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0]],
        [[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0],[1.1451,0.76863,0.47059,1],[1.32549,0.93333,0.54902,1],[1.34118,0.93333,0.54902,1],[1.34902,0.91765,0.54902,1],[1.38039,1.02745,0.70588,1],[1.36471,1.07451,0.77647,1],[1.33333,1.02745,0.71373,1],[1.3098,0.94902,0.63529,1],[1.33333,1.00392,0.69804,1],[1.36471,0.98039,0.68235,1],[1.34118,0.93333,0.63529,1],[1.32549,0.92549,0.61961,1],[1.35686,0.98824,0.6902,1],[1.38824,1.05098,0.76863,1],[1.46667,1.23922,1.01961,1],[1.42745,1.23137,1.03529,1],[1.12157,1.04314,1.04314,1],[2,2,2,0],[2,2,2,0],[2,2,2,0]],
        [[2,2,2,0],[2,2,2,0],[2,2,2,0],[1.0902,0.71373,0.44706,1],[1.23137,0.80784,0.46275,1],[1.34902,0.91765,0.53333,1],[1.34118,0.91765,0.52549,1],[1.35686,0.95686,0.56471,1],[1.40392,1.05098,0.70588,1],[1.32549,0.95686,0.62745,1],[1.20784,0.79216,0.46275,1],[1.21569,0.80784,0.49412,1],[1.24706,0.83137,0.48627,1],[1.27843,0.84706,0.54118,1],[1.29412,0.83922,0.52549,1],[1.31765,0.86275,0.54118,1],[1.38824,0.96471,0.65882,1],[1.45098,1.09804,0.82353,1],[1.48235,1.16863,0.93333,1],[1.49804,1.28627,1.06667,1],[1.41961,1.22353,1.01176,1],[2,2,2,0],[2,2,2,0],[2,2,2,0]],
        [[2,2,2,0],[2,2,2,0],[0.90196,0.58824,0.42353,1],[1.08235,0.69804,0.38431,1],[1.20784,0.8,0.46275,1],[1.30196,0.87843,0.53333,1],[1.32549,0.88627,0.52549,1],[1.35686,0.91765,0.56471,1],[1.35686,0.90196,0.58039,1],[1.35686,0.89412,0.56471,1],[1.28627,0.82353,0.51765,1],[1.28627,0.79216,0.51765,1],[1.29412,0.78431,0.5098,1],[1.3098,0.81569,0.53333,1],[1.33333,0.8549,0.56471,1],[1.37255,0.90196,0.61176,1],[1.46667,1.05882,0.80784,1],[1.52941,1.16863,0.91765,1],[1.45882,1.11373,0.86275,1],[1.38824,1.05882,0.84706,1],[1.43529,1.18431,0.95686,1],[1.24706,1.06667,0.94902,1],[2,2,2,0],[2,2,2,0]],
        [[2,2,2,0],[2,2,2,0],[0.95686,0.59608,0.36078,1],[1.24706,0.83137,0.53333,1],[1.29412,0.83137,0.50196,1],[1.27059,0.76078,0.41569,1],[1.2549,0.76078,0.41569,1],[1.30196,0.75294,0.42353,1],[1.36471,0.81569,0.50196,1],[1.38824,0.86275,0.57255,1],[1.37255,0.8549,0.57255,1],[1.37255,0.86275,0.58824,1],[1.41176,0.89412,0.62745,1],[1.42745,0.90196,0.63529,1],[1.38824,0.87843,0.61176,1],[1.38824,0.9098,0.64314,1],[1.43529,0.98039,0.71373,1],[1.52157,1.10588,0.8549,1],[1.46667,1.0902,0.8549,1],[1.40392,1.05098,0.83137,1],[1.34902,1.01176,0.8,1],[1.29412,1.06667,0.93333,1],[2,2,2,0],[2,2,2,0]],
        [[2,2,2,0],[0.58039,0.26667,0.20392,1],[0.8549,0.44706,0.25098,1],[1.1451,0.68235,0.4,1],[1.1451,0.65098,0.35294,1],[1.20784,0.65098,0.3451,1],[1.23137,0.65882,0.32941,1],[1.3098,0.71373,0.39216,1],[1.39608,0.78431,0.49412,1],[1.44314,0.83137,0.57255,1],[1.45882,0.84706,0.58824,1],[1.45882,0.88627,0.64314,1],[1.45882,0.9098,0.6902,1],[1.47451,0.91765,0.70588,1],[1.41961,0.87843,0.64314,1],[1.44314,0.87059,0.63529,1],[1.45882,0.90196,0.64314,1],[1.4902,0.96471,0.72941,1],[1.45882,0.96471,0.73725,1],[1.39608,0.96471,0.76863,1],[1.37255,1.02745,0.8549,1],[1.39608,1.16078,1.03529,1],[2,2,2,0],[2,2,2,0]],
        [[2,2,2,0],[0.65098,0.29804,0.24314,1],[1.00392,0.55686,0.35294,1],[1.12157,0.65098,0.38431,1],[1.15294,0.64314,0.40784,1],[1.24706,0.64314,0.36863,1],[1.33333,0.66667,0.36078,1],[1.36471,0.69804,0.4,1],[1.43529,0.73725,0.47059,1],[1.55294,0.83922,0.60392,1],[1.59216,0.86275,0.62745,1],[1.6,0.90196,0.6902,1],[1.58431,0.96471,0.80784,1],[1.56078,0.97255,0.81569,1],[1.52157,0.87843,0.69804,1],[1.59216,0.90196,0.71373,1],[1.55294,0.95686,0.75294,1],[1.52941,0.99608,0.78431,1],[1.45098,0.93333,0.72157,1],[1.45098,0.97255,0.77647,1],[1.42745,1.08235,0.92549,1],[1.45882,1.24706,1.11373,1],[2,2,2,0],[2,2,2,0]],
        [[2,2,2,0],[0.6902,0.31373,0.22745,1],[0.95686,0.51765,0.29804,1],[1.16078,0.68235,0.4549,1],[1.26275,0.70588,0.5098,1],[1.39608,0.72157,0.44706,1],[1.53725,0.83922,0.52549,1],[1.58431,0.88627,0.62745,1],[1.61569,0.9098,0.69804,1],[1.7098,1.00392,0.84706,1],[1.76471,1.01961,0.83137,1],[1.77255,1.08235,0.92549,1],[1.74902,1.11373,1.00392,1],[1.70196,1.12157,1.02745,1],[1.67843,1.08235,0.98039,1],[1.6549,1.06667,0.92549,1],[1.44314,0.98824,0.80784,1],[1.19216,0.80784,0.60392,1],[1.37255,0.99608,0.8,1],[1.56863,1.15294,0.94902,1],[1.43529,1.04314,0.88627,1],[1.40392,1.10588,0.95686,1],[2,2,2,0],[2,2,2,0]],
        [[2,2,2,0],[0.80784,0.42353,0.32157,1],[1.07451,0.65882,0.43137,1],[1.28627,0.87059,0.66667,1],[1.32549,0.80784,0.61176,1],[1.46667,0.8,0.53333,1],[1.63137,0.96471,0.70588,1],[1.6549,1.0902,0.87059,1],[1.6549,1.15294,0.97255,1],[1.74902,1.30196,1.16863,1],[1.77255,1.24706,1.12941,1],[1.80392,1.2549,1.16863,1],[1.79608,1.27059,1.22353,1],[1.81961,1.36471,1.31765,1],[1.82745,1.38824,1.30196,1],[1.58431,1.15294,1.06667,1],[1.23922,0.8549,0.77647,1],[1.38039,0.99608,0.93333,1],[1.57647,1.17647,1.0902,1],[1.61569,1.18431,1.02745,1],[1.46667,1.04314,0.89412,1],[1.33333,1.04314,0.9098,1],[2,2,2,0],[2,2,2,0]],
        [[2,2,2,0],[0.65882,0.30588,0.25098,1],[0.95686,0.61961,0.49412,1],[1.32549,0.97255,0.82353,1],[1.43529,0.93333,0.72941,1],[1.49804,0.86275,0.60392,1],[1.52157,0.89412,0.63529,1],[1.27843,0.76863,0.58039,1],[1.03529,0.54902,0.41569,1],[1.03529,0.56471,0.46275,1],[1.29412,0.81569,0.70588,1],[1.57647,1.06667,0.99608,1],[1.72549,1.12941,1.05882,1],[1.78824,1.19216,1.12157,1],[1.64706,1.13725,1.05882,1],[1.37255,0.94118,0.87059,1],[1.55294,1.15294,1.09804,1],[1.60784,1.09804,1.02745,1],[1.4902,0.93333,0.83922,1],[1.59216,1.1451,1.02745,1],[1.49804,1.07451,0.93333,1],[1.35686,1.0902,0.98039,1],[0.86275,0.67451,0.7451,1],[2,2,2,0]],
        [[2,2,2,0],[0.61961,0.26667,0.15686,1],[0.87843,0.55686,0.46275,1],[1.23922,0.8549,0.7451,1],[1.45098,0.87059,0.65882,1],[1.52157,0.87843,0.61176,1],[1.52157,0.92549,0.68235,1],[1.48235,0.93333,0.80784,1],[1.50588,0.91765,0.84706,1],[1.59216,1.08235,0.98824,1],[1.38824,0.94118,0.88627,1],[1.19216,0.66667,0.61176,1],[1.46667,0.84706,0.75294,1],[1.79608,1.18431,1.03529,1],[1.52941,1.05098,0.95686,1],[1.32549,0.88627,0.83137,1],[1.45882,0.99608,0.91765,1],[1.28627,0.93333,0.87843,1],[1.56863,1.16078,1.07451,1],[1.59216,1.2,1.08235,1],[1.6,1.12157,0.98039,1],[1.32549,0.98824,0.87059,1],[0.87843,0.55686,0.57255,1],[2,2,2,0]],
        [[2,2,2,0],[0.73725,0.32941,0.16471,1],[0.90196,0.5098,0.39216,1],[1.16078,0.6902,0.57255,1],[1.47451,0.82353,0.60392,1],[1.52157,0.82353,0.58039,1],[1.45098,0.84706,0.62745,1],[1.30196,0.71373,0.58039,1],[1.33333,0.70588,0.61961,1],[1.11373,0.72157,0.6902,1],[1.37255,1.00392,0.94902,1],[1.31765,0.83137,0.79216,1],[1.44314,0.8549,0.71373,1],[1.78824,1.15294,0.95686,1],[1.67843,1.15294,0.98824,1],[1.45882,0.93333,0.84706,1],[1.38039,0.98039,0.94118,1],[1.02745,0.84706,0.83137,1],[1.63137,1.27843,1.19216,1],[1.74118,1.41176,1.26275,1],[1.67059,1.18431,1.01176,1],[1.28627,0.91765,0.81569,1],[1.08235,0.70588,0.6902,1],[2,2,2,0]],
        [[2,2,2,0],[1.00392,0.51765,0.28235,1],[0.94118,0.48627,0.33725,1],[1.09804,0.63529,0.5098,1],[1.43529,0.79216,0.56471,1],[1.50588,0.76863,0.54118,1],[1.57647,0.97255,0.76078,1],[1.51373,1.05098,0.89412,1],[1.52157,1.01176,0.91765,1],[1.22353,0.88627,0.83137,1],[1.50588,1.18431,1.12941,1],[1.52941,1.03529,0.98824,1],[1.61569,0.96471,0.76863,1],[1.70196,1.01961,0.82353,1],[1.80392,1.27059,1.08235,1],[1.67059,1.18431,1.04314,1],[1.72549,1.31765,1.23922,1],[1.74118,1.35686,1.26275,1],[1.78824,1.41961,1.2549,1],[1.84314,1.49804,1.3098,1],[1.72549,1.24706,1.06667,1],[1.37255,0.92549,0.83922,1],[1.27059,0.92549,0.99608,1],[2,2,2,0]],
        [[2,2,2,0],[0.95686,0.54118,0.44706,1],[0.95686,0.46275,0.32157,1],[1.02745,0.54118,0.4549,1],[1.34902,0.73725,0.55686,1],[1.52941,0.80784,0.58039,1],[1.73333,1.12941,0.88627,1],[1.74118,1.2549,1.05098,1],[1.61569,1.0902,0.92549,1],[1.6,1.16078,1.03529,1],[1.60784,1.18431,1.11373,1],[1.66275,1.08235,0.97255,1],[1.63137,0.94118,0.77647,1],[1.64706,0.94902,0.77647,1],[1.84314,1.30196,1.13725,1],[1.74902,1.23922,1.0902,1],[1.75686,1.20784,1.04314,1],[1.87451,1.45098,1.29412,1],[1.86667,1.45098,1.27843,1],[1.83529,1.38039,1.2,1],[1.70196,1.16863,0.99608,1],[1.5451,1.10588,1.00392,1],[1.42745,1.12157,1.19216,1],[2,2,2,0]],
        [[2,2,2,0],[2,2,2,0],[1.10588,0.54902,0.36078,1],[0.99608,0.46275,0.36078,1],[1.27059,0.70588,0.56471,1],[1.52157,0.80784,0.55686,1],[1.68627,1.02745,0.77647,1],[1.82745,1.29412,1.03529,1],[1.81176,1.27843,1.03529,1],[1.84314,1.33333,1.12941,1],[1.81961,1.3098,1.16078,1],[1.74118,1.18431,1.01961,1],[1.52157,0.83137,0.62745,1],[1.63922,0.97255,0.80784,1],[1.85098,1.2549,1.11373,1],[1.69412,1.12941,1.01961,1],[1.78039,1.20784,1.06667,1],[1.88235,1.35686,1.21569,1],[1.85882,1.36471,1.23922,1],[1.73333,1.1451,0.98039,1],[1.6549,1.06667,0.92549,1],[1.67059,1.19216,1.06667,1],[1.55294,1.23137,1.23922,1],[2,2,2,0]],
        [[2,2,2,0],[2,2,2,0],[1.43529,0.69804,0.50196,1],[1.20784,0.55686,0.40784,1],[1.31765,0.72157,0.56471,1],[1.51373,0.81569,0.59608,1],[1.5451,0.79216,0.55686,1],[1.67843,0.95686,0.7451,1],[1.74902,1.10588,0.87843,1],[1.81961,1.24706,1.03529,1],[1.81176,1.26275,1.09804,1],[1.77255,1.17647,1.01961,1],[1.52941,0.8549,0.6902,1],[1.63922,1.03529,0.87843,1],[1.7098,1.1451,1.02745,1],[1.62353,1.12941,1.01961,1],[1.74902,1.16078,1.0902,1],[1.82745,1.30196,1.17647,1],[1.80392,1.26275,1.11373,1],[1.66275,1.04314,0.89412,1],[1.63137,1.01176,0.86275,1],[1.73333,1.26275,1.12157,1],[1.45882,1.2,1.23922,1],[2,2,2,0]],
        [[2,2,2,0],[2,2,2,0],[1.28627,0.8,0.86275,1],[1.71765,1.00392,0.72941,1],[1.55294,0.89412,0.66667,1],[1.53725,0.77647,0.57255,1],[1.52157,0.72941,0.53333,1],[1.45882,0.69804,0.50196,1],[1.53725,0.80784,0.61176,1],[1.68627,0.98039,0.78431,1],[1.74118,1.0902,0.91765,1],[1.73333,1.08235,0.94118,1],[1.38824,0.69804,0.57255,1],[1.00392,0.37647,0.25882,1],[1.23137,0.55686,0.43137,1],[1.23137,0.57255,0.48627,1],[1.74118,1.11373,1.04314,1],[1.78039,1.22353,1.11373,1],[1.76471,1.2,1.05882,1],[1.6549,1.02745,0.88627,1],[1.63137,0.98039,0.82353,1],[1.60784,1.06667,0.94118,1],[2,2,2,0],[2,2,2,0]],
        [[2,2,2,0],[2,2,2,0],[2,2,2,0],[1.78824,1.13725,0.89412,1],[1.6549,0.96471,0.72157,1],[1.53725,0.7451,0.52549,1],[1.57647,0.8,0.58039,1],[1.48235,0.72941,0.51765,1],[1.43529,0.6902,0.48627,1],[1.56863,0.8,0.61176,1],[1.7098,0.99608,0.77647,1],[1.74902,1.03529,0.8549,1],[1.63137,0.88627,0.70588,1],[1.41961,0.69804,0.5098,1],[1.6,0.98039,0.81569,1],[1.74902,1.16078,1.01176,1],[1.73333,1.07451,0.91765,1],[1.73333,1.12157,0.98039,1],[1.69412,1.05098,0.88627,1],[1.63137,1.00392,0.8549,1],[1.64706,1.01176,0.83922,1],[1.16863,0.73725,0.83922,1],[2,2,2,0],[2,2,2,0]],
        [[2,2,2,0],[2,2,2,0],[2,2,2,0],[1.38824,0.84706,0.90196,1],[1.70196,0.93333,0.6902,1],[1.49804,0.72941,0.49412,1],[1.5451,0.76863,0.53333,1],[1.49804,0.70588,0.48627,1],[1.45882,0.70588,0.4549,1],[1.47451,0.73725,0.5098,1],[1.56863,0.80784,0.55686,1],[1.72549,1.00392,0.77647,1],[1.68627,0.94902,0.72157,1],[1.7098,1.01176,0.80784,1],[1.78039,1.08235,0.99608,1],[1.78039,1.1451,1.05882,1],[1.74902,1.2,1.01961,1],[1.68627,1.04314,0.87843,1],[1.63922,0.96471,0.78431,1],[1.61569,1.00392,0.82353,1],[1.6549,0.98824,0.8,1],[2,2,2,0],[2,2,2,0],[2,2,2,0]],
        [[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0],[0.92549,0.42353,0.4,1],[1.43529,0.68235,0.50196,1],[1.4902,0.70588,0.5098,1],[1.45882,0.68235,0.4549,1],[1.45098,0.70588,0.44706,1],[1.43529,0.70588,0.4549,1],[1.41961,0.64314,0.41569,1],[1.46667,0.71373,0.47843,1],[1.6,0.91765,0.6902,1],[1.2,0.58039,0.47059,1],[0.46275,0.14118,0.16471,1],[0.54902,0.11765,0.12549,1],[1.52157,0.98039,0.87843,1],[1.63137,1.04314,0.89412,1],[1.6549,0.98824,0.78431,1],[1.63922,1.01961,0.8,1],[1.60784,0.95686,0.72941,1],[2,2,2,0],[2,2,2,0],[2,2,2,0]],
        [[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0],[1.35686,0.65098,0.48627,1],[1.32549,0.57255,0.37647,1],[1.43529,0.67451,0.43922,1],[1.49804,0.76863,0.51765,1],[1.55294,0.82353,0.58039,1],[1.56078,0.82353,0.55686,1],[1.47451,0.73725,0.47843,1],[1.36471,0.68235,0.5098,1],[0.93333,0.37647,0.37647,1],[0.44706,0.38431,0.38431,1],[0.65098,0.26667,0.2902,1],[1.38039,0.70588,0.69804,1],[1.55294,0.91765,0.79216,1],[1.66275,1.03529,0.80784,1],[1.63922,0.99608,0.76863,1],[1.61569,0.91765,0.66667,1],[2,2,2,0],[2,2,2,0],[2,2,2,0]],
        [[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0],[1.16078,0.57255,0.44706,1],[1.23922,0.52549,0.28235,1],[1.3098,0.58824,0.33725,1],[1.48235,0.73725,0.47843,1],[1.57647,0.83137,0.56471,1],[1.57647,0.80784,0.54118,1],[1.52941,0.75294,0.50196,1],[1.48235,0.65882,0.48627,1],[1.63137,0.69804,0.71373,1],[1.67059,0.73725,0.79216,1],[1.64706,0.60392,0.68235,1],[1.57647,0.84706,0.77647,1],[1.56863,0.83137,0.69804,1],[1.56078,0.88627,0.72941,1],[1.6,0.97255,0.77647,1],[1.56863,0.92549,0.65882,1],[2,2,2,0],[2,2,2,0],[2,2,2,0]],
        [[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0],[0.72157,0.4549,0.36863,1],[1.28627,0.54902,0.2902,1],[1.28627,0.56471,0.31373,1],[1.44314,0.6902,0.43137,1],[1.46667,0.71373,0.4549,1],[1.44314,0.68235,0.42353,1],[1.47451,0.65098,0.41569,1],[1.36471,0.54902,0.31373,1],[1.20784,0.43137,0.32157,1],[1.35686,0.63529,0.63529,1],[1.37255,0.66667,0.68235,1],[1.38824,0.65882,0.49412,1],[1.52157,0.78431,0.60392,1],[1.5451,0.87843,0.69804,1],[1.61569,0.98824,0.78431,1],[1.34118,0.80784,0.62745,1],[2,2,2,0],[2,2,2,0],[2,2,2,0]],
        [[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0],[0,0,0.06275,1],[1.11373,1.04314,0.98039,1],[1.30196,0.70588,0.48627,1],[1.28627,0.57255,0.30588,1],[1.38039,0.64314,0.39216,1],[1.45882,0.7451,0.5098,1],[1.38824,0.67451,0.44706,1],[1.50588,0.72941,0.5098,1],[1.50588,0.70588,0.47843,1],[1.43529,0.70588,0.51765,1],[1.37255,0.76078,0.62745,1],[1.45098,0.83137,0.72157,1],[1.63137,0.94118,0.79216,1],[1.67843,1.00392,0.83137,1],[1.58431,0.98039,0.8,1],[1.49804,0.89412,0.69804,1],[1.09804,0.73725,0.63529,1],[0.28235,0.36078,0.55686,1],[2,2,2,0],[2,2,2,0]],
        [[2,2,2,0],[2,2,2,0],[0.26667,0.36863,0.64314,1],[0.23529,0.25098,0.3451,1],[0,0,0.02353,1],[1.26275,1.23137,1.16078,1],[1.66275,1.43529,1.3098,1],[1.09804,0.44706,0.21176,1],[1.22353,0.54118,0.32941,1],[1.31765,0.65882,0.4549,1],[1.30196,0.65098,0.46275,1],[1.35686,0.63529,0.43137,1],[1.64706,0.8549,0.65098,1],[1.67059,0.90196,0.7451,1],[1.72549,1.02745,0.90196,1],[1.71765,1.02745,0.87843,1],[1.68627,1.01961,0.87059,1],[1.63922,0.98039,0.81569,1],[1.38824,0.83922,0.65882,1],[1.21569,0.70588,0.52549,1],[1.46667,1.34902,1.3098,1],[0.29804,0.36078,0.52549,1],[0.29804,0.36863,0.54902,1],[2,2,2,0]],
        [[0.23529,0.35294,0.61176,1],[0.21961,0.30588,0.49412,1],[0.21176,0.26667,0.38431,1],[0.18039,0.18039,0.25882,1],[0.00784,0,0.04706,1],[1.16863,1.13725,1.08235,1],[1.93725,1.87451,1.79608,1],[1.45098,1.23922,1.12157,1],[0.94118,0.46275,0.2902,1],[1.05882,0.47843,0.33725,1],[1.16078,0.54118,0.40784,1],[1.0902,0.47843,0.3451,1],[1.23137,0.54902,0.39216,1],[1.43529,0.6902,0.52549,1],[1.51373,0.75294,0.64314,1],[1.48235,0.72157,0.63529,1],[1.30196,0.66667,0.57255,1],[1.08235,0.59608,0.50196,1],[0.94902,0.51765,0.39216,1],[1.24706,1.00392,0.93333,1],[1.79608,1.82745,1.82745,1],[0.27451,0.36078,0.52549,1],[0.25098,0.30588,0.47059,1],[0.30588,0.36078,0.52549,1]],
        [[0.18039,0.27451,0.46275,1],[0.20392,0.29804,0.47059,1],[0.21961,0.28235,0.43137,1],[0.17255,0.17255,0.27451,1],[0.03137,0.02353,0.12549,1],[1.03529,1.03529,0.99608,1],[2,1.97647,1.90588,1],[1.85098,1.81961,1.74118,1],[1.45098,1.34118,1.2549,1],[0.94118,0.62745,0.52549,1],[0.88627,0.41569,0.28235,1],[0.98039,0.44706,0.2902,1],[0.76863,0.33725,0.23529,1],[0.61961,0.21961,0.20392,1],[0.65882,0.23529,0.23529,1],[0.65882,0.22745,0.20392,1],[0.55686,0.26667,0.21961,1],[0.62745,0.32941,0.26667,1],[0.96471,0.76078,0.70588,1],[1.78824,1.81176,1.81961,1],[1.59216,1.64706,1.70196,1],[0.22745,0.28235,0.44706,1],[0.22745,0.25882,0.43137,1],[0.29804,0.33725,0.5098,1]],
        [[0.15686,0.22745,0.41569,1],[0.18039,0.25098,0.41569,1],[0.20392,0.26667,0.40784,1],[0.15686,0.17255,0.29804,1],[0.09412,0.08627,0.21176,1],[0.49412,0.48627,0.52549,1],[1.92157,1.89804,1.81176,1],[1.9451,1.91373,1.85098,1],[1.82745,1.81176,1.75686,1],[1.50588,1.50588,1.45882,1],[1.00392,0.83922,0.82353,1],[0.82353,0.52549,0.4549,1],[0.64314,0.26667,0.22745,1],[0.43922,0.10196,0.09412,1],[0.26667,0.00784,0.01569,1],[0.3451,0.04706,0.04706,1],[0.59608,0.29804,0.29804,1],[1.12157,1.01176,1.00392,1],[1.78039,1.84314,1.87451,1],[2,2,2,0],[1.10588,1.16078,1.2549,1],[0.13333,0.18039,0.35294,1],[0.18824,0.23529,0.39216,1],[0.26667,0.30588,0.47843,1]],
        [[0.13333,0.18824,0.36078,1],[0.15686,0.22745,0.38431,1],[0.16471,0.22745,0.39216,1],[0.13333,0.16471,0.29804,1],[0.07843,0.10196,0.21961,1],[0.13333,0.14902,0.27451,1],[1.68627,1.66275,1.58431,1],[1.88235,1.87451,1.81176,1],[1.92157,1.89804,1.84314,1],[1.81176,1.80392,1.74118,1],[1.66275,1.67059,1.61569,1],[1.37255,1.32549,1.29412,1],[0.98039,0.7451,0.7451,1],[0.4,0.08627,0.12549,1],[0.18824,0,0,1],[0.56471,0.4,0.43922,1],[1.45882,1.46667,1.51373,1],[1.90588,2,2,1],[1.97647,2,2,1],[2,2,2,0],[0.62745,0.6902,0.81569,1],[0.07843,0.14902,0.32157,1],[0.14902,0.19608,0.36863,1],[0.21961,0.26667,0.43922,1]]];

        const trumpMassQuantityEl = document.querySelector('trump-mass-quantity'),
              orbitStatisticsQuantityEl = document.querySelector('orbit-statistics-quantity'),
              massNameEls = document.getElementsByTagName('mass-name'),
              lookAtMassNameEl = document.querySelector('look-at-mass-name'),
              lookAtMassQuantityEl = document.querySelector('look-at-mass-quantity'),
              lookAtDistanceQuantityEl = document.querySelector('look-at-distance-quantity'),
              lookAtTrumpDistanceQuantityEl = document.querySelector('look-at-trump-distance-quantity'),
              massQuantityEl = document.querySelector('mass-quantity'),
              distanceQuantityEl = document.querySelector('distance-quantity'),
              catchUpQuantityEl = document.querySelector('catch-up-quantity'),
              trumpTweetEl = document.querySelector('trump-tweet'),
              absorbedEl = document.querySelector('absorbed'),
              absorbedNameEl = document.querySelector('absorbed-name'),
              absorbedByNameEl = document.querySelector('absorbed-by-name');

        const tagEl = document.querySelector('tag'),
              currentLookAtEl = document.querySelector('current-look-at'),
              commandsEl = document.querySelector('commands'),
              helpEl = document.querySelector('help'),
              helpContentEl = document.querySelector('help-content'),
              previousLookAtEl = document.querySelector('previous-look-at'),
              nextLookAtEl = document.querySelector('next-look-at');

        class Mass {
          constructor(mass, color, position = [0, 0, 0], velocity = [0, 0, 0], acceleration = [0, 0, 0], gravity = [0, 0, 0]) {
            this.mass = mass;
            this.color = color;
            this.position = position;
            this.velocity = velocity;
            this.acceleration = acceleration;
            this.gravity = gravity;
            this.created = currentTick; // !!!!!!!!!!!!!!!!!!!111
          }

          get name() { return 'Mass'; }

          get size() { return 1000 * Math.log2(this.mass + 1); }

          positionHalfTick(ticksPerSecond) {
            const {position: p, velocity: v} = this;
            p[0] += v[0] / ticksPerSecond / 2;
            p[1] += v[1] / ticksPerSecond / 2;
            p[2] += v[2] / ticksPerSecond / 2;
          }

          velocityTick(ticksPerSecond) {
            const {
              velocity: v,
              acceleration: a,
              gravity: g
            } = this;

            v[0] += (a[0] + g[0]) / ticksPerStep;
            v[1] += (a[1] + g[1]) / ticksPerStep;
            v[2] += (a[2] + g[2]) / ticksPerStep;
          }
        }

        class Trump extends Mass {
          get name() { return '<trump>TRUMP</trump>'; }
          get size() { return 0; }
        }

        class Observer extends Mass {
          get name() { return 'Observer'; }
        }

        class Tweet extends Mass {
          constructor(...args) {
            super(...args);

            this.likes = 0;
            this.retweets = 0;
            this.followers = 0; // only the oldTweets tweet should use this (new class?)
          }
          get name() { return 'Tweet'; }
        }

        class OldTweets extends Tweet {
          get name() { return 'Tweet\'s of <trump>TRUMP</trump>\'s Past'; }
        }

        class TweetSpawn extends Mass { }

        class Like extends TweetSpawn {
          get name() { return 'Like'; }
        }

        class ReTweet extends TweetSpawn {
          get name() { return 'Retweet'; }
        }

        class Follower extends TweetSpawn {
          get name() { return 'New Follower'; }
        }

        class Media extends Mass {
          constructor(mediaName, ...args) {
            super(...args);
            this.mediaName = mediaName;
          }

          get name() { return this.mediaName; }
        };

        const trump = new Trump(100000, [ 255,   255,    0, 0]),
              oldTweets = new OldTweets(2000, [0, 1, 1.2, 0.5], [-2000, -2000, 0], [320, 0, -320]),
              universe = [trump, oldTweets],
              tweets = [oldTweets],
              tweetMap = {},
              tweetSpawn = [],
              spawningTweets = new Set(),
              media = [],
              observers = [],
              events = [],
              uievents = [];

        const MAX_TWEET_SPAWN = 50,
              MAX_TWEET_SPAWN_AGE = 60 * 5,
              MAX_OBSERVERS = 51;

        const [
          positions,
          velocities,
          accelerations,
          gravities,
          masses,
          sizes,
          colors
        ] = map(universe, ['position', 'velocity', 'acceleration', 'gravity', 'mass', 'size', 'color']);

        let positionIndex = 1,
            lookAtIndex = 0;

        function map(list, properties) {
          return properties.map(p => list.map(item => item[p]));
        }

        function addMass(newMass, view) { // don't want view here!
          const {position, velocity, acceleration, gravity, mass, size, color} = newMass;

          universe.push(newMass);
          positions.push(position);
          velocities.push(velocity);
          accelerations.push(acceleration);
          gravities.push(gravity);
          masses.push(mass);
          sizes.push(size);
          colors.push(color);

          // get this out of here asap!
          orbitStatisticsQuantityEl.innerHTML = Math.max(0, universe.length - 1);

          view.select('#positions').set('width', positions.length);
          view.select('#colors').set('width', colors.length);
          view.select('#sizes').set('width', sizes.length);

          return newMass;
        }

        function addObserver(event, view) {
          if (observers.length === 0) positionIndex = universe.length;

          if (observers.length < MAX_OBSERVERS) {
            const tp = trump.position;
            const observer = addMass(new Observer(1, [255, 255, 255, 1], [tp[0], tp[1], tp[2] + 5000], [420, -1, 0]), view);

            observers.push(observer);
          }
          else {
            const observer = observers[Math.round(Math.random() * (observers.length - 1))];
            observer.mass++;
          }
        }

        function addTweet(event, view) {
          lookAtIndex = universe.length;
          // this should be calculated based on current trump mass (and, maybe, positions/velocities of orbiting masses?)
          const tp = trump.position; // ?

          const tweet = new Tweet(800, [0, 1, 1.2, 2],
                                       [tp[0], tp[1], tp[2] + 350],
                                       [1000, -1, 0]),
                cnn = new Media('CNN', 5, [2, 2, 2, 1],
                                          [tp[0] + 90, tp[1] + 0, tp[2] + 350],
                                          [1000, 5, 0]);

          tweet.tweetID = event[1] || 'fake';

          addMass(tweet, view);
          addMass(cnn, view);

          tweets.push(tweet);
          media.push(cnn);

          tweetMap[tweet.tweetID] = tweet;

          uievents.push(['tweet']);
        }

        function addRetweet(event, view) {
          addTweetSpawn(tweetMap[event[1]] || oldTweets, ReTweet, 1, [25 / 128, 207 / 128, 134 / 128, 2], view);
        }

        function addLike(event, view) {
          addTweetSpawn(tweetMap[event[1]] || oldTweets, Like, 1, [190 / 128, 25 / 128, 49 / 128, 2], view);
        }

        function addFollower(event, view) {
          addTweetSpawn(oldTweets, Follower, 1, [0 / 128, 25 / 128, 256 / 128, 2], view);
        }

        const spread = 700;

        function addTweetSpawn(tweet, constructor, mass, color, view) {
          if (!tweet) throw new Error('No tweet!!!!!!@!');

          const {position: p} = tweet,
                {position: tp, velocity: tv} = universe[0];

          const x = 20;

          const d = [0, 0, 0];

          d[0] = tp[0] - p[0];
          d[1] = tp[1] - p[1];
          d[2] = tp[2] - p[2];

          const m = magnitude(d);

          const position = [p[0] + d[0] / m * (50 + spread * Math.random())
                           ,p[1] + d[1] / m * (50 + spread * Math.random())
                           ,p[2] + d[2] / m * (50 + spread * Math.random())];

          const d2 = [tp[0] - position[0]
                     ,tp[1] - position[1]
                     ,tp[2] - position[2]];

          const spawn = new constructor(mass, color, position,
                                      [tv[0] + d[0]/x, tv[1] + d[1]/x, tv[2] + d[2]/x]);
          addMass(spawn, view);
          tweetSpawn.push(spawn);
        }

        function absorbed(event) {
          uievents.push(event);
        }

        function incrementLikes([_, id, likes], view) {
          const tweet = tweetMap[id] || oldTweets;
          tweet.likes += likes;
          spawningTweets.add(tweet);
        }

        function incrementRetweets([_, id, retweets], view) {
          const tweet = tweetMap[id] || oldTweets;
          tweet.retweets += retweets;
          spawningTweets.add(tweet);
        }

        function incrementFollowers([_, followers], view) {
          oldTweets.followers += followers;
        }

        let trumpScaleFactor = 5;
        <root>
          <camera proxy={false}
                  position={t => cameraPosition}
                  lookAt={t => universe[lookAtIndex].position}
                  fov={90} />
          <cartesian range={[[-1, 1], [-1, 1], [-1, 1]]}
                     scale={[1, 1, 1]}>
            <cartesian range={[[-1, 1], [-1, 1], [-1, 1]]}
                       scale={[trumpColors[0].length * trumpScaleFactor, trumpColors.length * trumpScaleFactor, trumpColors.length * trumpScaleFactor]}
                       position={t => trump.position}
                       rotation={[Math.PI, 0, 0]}>
              <area height={trumpColors.length} width={trumpColors[0].length} />
              <matrix id="trump"
                      width={trumpColors[0].length}
                      height={trumpColors.length}
                      data={trumpColors} />
              <point points="<<" colors="<" size={1200 * trumpScaleFactor} shape="square" opacity={1}/>
            </cartesian>

            <array id="positions"
                   width={universe.length}
                   channels={3}
                   history={1}
                   data={positions} />
            <array id="colors"
                   width={universe.length}
                   channels={4}
                   data={colors} />
            <array id="sizes"
                   width={universe.length}
                   channels={1}
                   data={sizes} />
            <point points="<<<" colors="<<" sizes="<" shape="circle" opacity={0.9}/>
          </cartesian>
        </root>


        function add (r, v1, v2) {
          r[0] = v1[0] + v2[0];
          r[1] = v1[1] + v2[1];
          r[2] = v1[2] + v2[2];
          return r;
        }

        function sub (r, v1, v2) {
          r[0] = v1[0] - v2[0];
          r[1] = v1[1] - v2[1];
          r[2] = v1[2] - v2[2];
          return r;
        }

        function scale (r, v, s) {
          r[0] = v[0] * s;
          r[1] = v[1] * s;
          r[2] = v[2] * s;
          return r;
        }

        const speedlimit = 300000;
        const pv1 = [0, 0, 0],
              pv2 = [0, 0, 0],
              oldp1 = [0, 0, 0],
              oldp2 = [0, 0, 0],
              dd = [0, 0, 0];


        const collisionList = []; // where should this go?
        let collisionIIndex = 0;

        const cameraPosition = [0, 0, 0];
        let cameraOffset = [0, 225, 0];

        let ticksPerSecond = 60,
            ticksPerStep = 10,
            stepsPerSecond = 1;

        let currentTick = 0;
        function tick() {
          currentTick++;

          updateTweetSpawn();
          positionHalfTick();
          updateGravities();
          updateVelocities();
          resolveCollisions();

          updateMassesGUI();

          function updateTweetSpawn() {
            const {position: tp, velocity: tv} = trump;

            for (let i = 0; i < tweetSpawn.length; i++) {
              const spawn = tweetSpawn[i],
                    {mass, position: p, velocity: v, created} = spawn;

              const age = currentTick - created;
              const x = Math.max(1, 250 / Math.min(250, age));

              dd[0] = tp[0] - p[0];
              dd[1] = tp[1] - p[1];
              dd[2] = tp[2] - p[2];

              v[0] = tv[0] + dd[0]/x;
              v[1] = tv[1] + dd[1]/x;
              v[2] = tv[2] + dd[2]/x;

              if (age > MAX_TWEET_SPAWN_AGE) {
                const index = universe.indexOf(spawn);
                if (index === -1) {
                  console.log('-1!', age, spawn, universe);
                }
                else {
                  collisionList.push([true, spawn, trump, index]);
                }
              }
            }

            resolveCollisions();

            if (tweetSpawn.length < MAX_TWEET_SPAWN) {
              spawningTweets.forEach(tweet => {
                if (tweet.likes > 0 && Math.random() > 0.1) {
                  tweet.likes--;
                  events.push(['like', tweet.tweetID]);
                }
                if (tweet.retweets > 0 && Math.random() > 0.1) {
                  tweet.retweets--;
                  events.push(['retweet', tweet.tweetID]);
                }
                if (tweet.followers > 0 && Math.random() > 0.1) {
                  tweet.followers--;
                  events.push(['follower']);
                }
              });
            }
          }

          function positionHalfTick() {
            for (let i = 0; i < universe.length; i++) {
              const mass = universe[i];

              mass.positionHalfTick(ticksPerSecond);
              mass.gravity[0] = 0;
              mass.gravity[1] = 0;
              mass.gravity[2] = 0;
            }
          }

          // can be optimized quite a bit? ?
          function updateGravities() {
            for (let i = 0; i < universe.length; i++) updatePairs(i);
          }

          function updatePairs(i) {
            const {
              position: p1,
              velocity: v1,
              acceleration: a1,
              gravity: g1,
              mass: m1,
              size: s1
            } = universe[i];

            for (let j = i + 1; j < universe.length; j++) updatePair(p1, v1, a1, g1, m1, s1, i, j);

            // F = ma ... a = F/m
            g1[0] = g1[0] / m1;
            g1[1] = g1[1] / m1;
            g1[2] = g1[2] / m1;
          }

          function updatePair(p1, v1, a1, g1, m1, s1, i, j) {
            const {
              position: p2,
              velocity: v2,
              acceleration: a2,
              mass: m2,
              size: s2,
              gravity: g2
            } = universe[j];

            dd[0] = p1[0] - p2[0];
            dd[1] = p1[1] - p2[1];
            dd[2] = p1[2] - p2[2];

            const t = -magnitude(dd) / (speedlimit * speedlimit),
                  o = t / ticksPerStep;

            // Probably a better way to do this?
            oldp1[0] = p1[0] + o * (v1[0] + (v1[0] + o * (a1[0] /*+ g1[0]*/)) / 2);
            oldp1[1] = p1[1] + o * (v1[1] + (v1[1] + o * (a1[1] /*+ g1[1]*/)) / 2);
            oldp1[2] = p1[2] + o * (v1[2] + (v1[2] + o * (a1[2] /*+ g1[2]*/)) / 2);

            oldp2[0] = p2[0] + o * (v2[0] + (v2[0] + o * (a2[0] /*+ g2[0]*/)) / 2);
            oldp2[1] = p2[1] + o * (v2[1] + (v2[1] + o * (a2[1] /*+ g2[1]*/)) / 2);
            oldp2[2] = p2[2] + o * (v2[2] + (v2[2] + o * (a2[2] /*+ g2[2]*/)) / 2);

            pv1[0] = oldp1[0] - p2[0];
            pv1[1] = oldp1[1] - p2[1];
            pv1[2] = oldp1[2] - p2[2];

            pv2[0] = oldp2[0] - p1[0];
            pv2[1] = oldp2[1] - p1[1];
            pv2[2] = oldp2[2] - p1[2];

            const d1 = magnitude(pv1),
                  d2 = magnitude(pv2);

            // Doesn't take into account mass having changed over time...
            if (d1 > 0) {
              const factor = (m1 * m2) / (d1 * d1);

              g2[0] += pv1[0] * factor;
              g2[1] += pv1[1] * factor;
              g2[2] += pv1[2] * factor;
            }

            if (d2 > 0) {
              const factor = (m1 * m2) / (d2 * d2);

              g1[0] += pv2[0] * factor;
              g1[1] += pv2[1] * factor;
              g1[2] += pv2[2] * factor;
            }

            if (universe[i].futureCollision) {
              collisionList.push(universe[i].futureCollision);
              delete universe[i].futureCollision;
            }
            else { // I don't think there should be an else, but these both *can't* run, or the resolve will break;
              const threshold = 4 * Math.log2(m1 + m2) / 3;
              if (d1 < threshold || d2 < threshold) { // better ordering of checks?
                if (m1 < m2) {
                  //wtf is this
                  collisionList.push([universe[i], universe[j], i]);
                }
                else {
                  universe[j].futureCollision = [universe[j], universe[i], j];
                }
              }
            }
          }

          function updateVelocities() {
            universe.forEach(mass => {
              mass.velocityTick(ticksPerStep);
              mass.positionHalfTick(ticksPerStep);
            });
          }

          function resolveCollisions() {
            for (let i = collisionList.length - 1; i >= 0; i--) {
              const [smallerMass, greaterMass] = collisionList[i];

              greaterMass.mass += smallerMass.mass;
            }

            for (let i = collisionList.length - 1; i >= 0; i--) {
              const [smallerMass, greaterMass, smallerIndex] = collisionList[i];

              if (smallerMass instanceof TweetSpawn) {
                tweetSpawn.splice(tweetSpawn.indexOf(smallerMass), 1);
              }
              else if (smallerMass instanceof Tweet) {
                tweets.splice(tweets.indexOf(smallerMass), 1);
                delete tweetMap[smallerMass.tweetID];
              }
              else if (smallerMass instanceof Observer) {
                observers.splice(observers.indexOf(smallerMass), 1);
              }

              if (smallerMass instanceof Tweet ||
                  smallerMass instanceof Media ||
                  smallerMass instanceof Trump ||
                  greaterMass instanceof Tweet ||
                  greaterMass instanceof Media ||
                  greaterMass instanceof Trump) {
                events.push(['absorbed', smallerMass.name, greaterMass.name]);
              }

              universe.splice(smallerIndex, 1);
              positions.splice(smallerIndex, 1);
              velocities.splice(smallerIndex, 1);
              accelerations.splice(smallerIndex, 1);
              gravities.splice(smallerIndex, 1);
              masses.splice(smallerIndex, 1);
              sizes.splice(smallerIndex, 1);
              colors.splice(smallerIndex, 1);

              if (positionIndex >= smallerIndex && positionIndex > 0) {
                if (positionIndex === smallerIndex) positionIndex = positions.length - 1;
                else positionIndex--;
              }
              if (lookAtIndex >= smallerIndex) {
                previousLookAt();
              }
            }

            collisionList.splice(0);
            collisionIIndex = 0;
          }
        }

        function magnitude(vector) {
          return Math.sqrt(vector[0] * vector[0] +
                           vector[1] * vector[1] +
                           vector[2] * vector[2]);
        }

        let selectedMassIndex = 0, savedColor = [0, 0, 0];
        selectMass(selectedMassIndex);

        if (window.location.search === '?nointro') document.querySelector('notice').classList.add('no-intro');

        updateMassesGUI();

        function updateMassesGUI() {
          trumpMassQuantityEl.innerHTML = universe[0].mass.toFixed(1);

          const masses = Math.max(0, universe.length - 1);
          orbitStatisticsQuantityEl.innerHTML = masses + ' mass' + (masses > 1 ? 'es' : '');

          const currentMass = universe[positionIndex];

          const distance = magnitude(sub(dd, currentMass.position, trump.position));

          massNameEls[0].innerHTML = currentMass.name;
          massNameEls[1].innerHTML = currentMass.name;

          massQuantityEl.innerHTML = currentMass.mass.toFixed(1);
          distanceQuantityEl.innerHTML = distance.toFixed(1);


          const lookAtMass = universe[lookAtIndex];
          lookAtMassNameEl.innerHTML = lookAtMass.name;

          if (lookAtIndex > 0) {
            const lookAtDistance = magnitude(sub(dd, lookAtMass.position, currentMass.position)),
                  lookAtTrumpDistance = magnitude(sub(dd, lookAtMass.position, trump.position));

            lookAtMassQuantityEl.innerHTML = lookAtMass.mass.toFixed(1);
            lookAtDistanceQuantityEl.innerHTML = lookAtDistance.toFixed(1);
            lookAtTrumpDistanceQuantityEl.innerHTML = lookAtTrumpDistance.toFixed(1);
            currentLookAtEl.classList.remove('is-trump');
          }
          else {
            currentLookAtEl.classList.add('is-trump');
          }
        }

        tagEl.addEventListener('click', () => commandsEl.classList.toggle('show'));

        helpEl.addEventListener('click', () => helpContentEl.classList.toggle('show'));

        previousLookAtEl.addEventListener('click', () => {
          cameraOffset[0] = 0;
          cameraOffset[1] = 100;
          cameraOffset[2] = 0;
          return previousLookAt();
        });

        nextLookAtEl.addEventListener('click', () => {
          cameraOffset[0] = 0;
          cameraOffset[1] = 100;
          cameraOffset[2] = 0;
          return nextLookAt();
        });

        function nextLookAt() {
          lookAtIndex = (lookAtIndex + 1) % universe.length;
          return lookAtIndex === positionIndex ? nextLookAt() : lookAtIndex;
        }

        function previousLookAt() {
          lookAtIndex === 0 ? lookAtIndex = universe.length - 1 : lookAtIndex--;
          return lookAtIndex === positionIndex ? previousLookAt() : lookAtIndex;
        }

        module.exports = {
          editorPanel: false,
          plugins: ['core', 'controls', 'cursor'],
          callback: start,
          camera: {far: 1000000},
          controls: [
            [['A'], 'left'],
            [['D'], 'right'],
            [['W'], 'forward'],
            [['S'], 'backward'],
            [['Q'], 'up'],
            [['Z'], 'down'],
            [['H'], 'toggleHistory'],
            [['T'], 'fakeTweet'],
            [['R'], 'fakeRetweet'],
            [['K'], 'fakeLike'],
            [['L'], 'lookAtTrump'],
            [['O'], 'overview'],
            [['F'], 'frontview'],
            [['V'], 'sideview'],
            [[190], 'speed+'],
            [[188], 'speed-'],
            [['0'], 'ticks+'],
            [['9'], 'ticks-'],
            [[32], 'changePlayer'],
            [[13], 'newMass'],
            [[221], 'nextMass'],
            [[219], 'prevMass']
          ],
          commands: {
            'left': () => velocities[selectedMassIndex][0]--,
            'right': () => velocities[selectedMassIndex][0]++,
            'forward': () => velocities[selectedMassIndex][2]--,
            'backward': () => velocities[selectedMassIndex][2]++,
            'up': () => velocities[selectedMassIndex][1]++,
            'down': () => velocities[selectedMassIndex][1]--,
            'lookAtTrump': () => lookAtIndex = 0,
            'overview': () => {lookAtIndex = 0; positionIndex = 0; cameraOffset = [0, 5000, 0];},
            'frontview': () => {lookAtIndex = 0; positionIndex = 0; cameraOffset = [0, 0, 5000];},
            'sideview': () => {lookAtIndex = 0; positionIndex = 0; cameraOffset = [-5000, 0, 0];},
            'speed+': () => ++stepsPerSecond,
            'speed-': () => stepsPerSecond = Math.max(1, stepsPerSecond - 1),
            'ticks+': () => ++ticksPerStep,
            'ticks-': () => ticksPerStep = Math.max(1, ticksPerStep - 1),
            'changePlayer'() {
              unselectMass(selectedMassIndex);
              (selectedMassIndex = (selectedMassIndex + 1) % positions.length);
              selectMass(selectedMassIndex);
            },
            'toggleHistory': {
              '#positions': {
                'history'() {
                  // doesn't work :(
                  return 1;
                }
              }
            },
            'fakeTweet': {
              '#positions': {
                'width'() {
                  events.push(['tweet']);
                  return universe.length;
                }
              },
              '#colors': {
                'width'() { return universe.length; }
              },
              '#velocities': {
                'width'() { return universe.length; }
              },
              '#sizes': {
                'width'() { return universe.length; }
              }
            },
            'fakeRetweet': {
              '#positions': {
                'width'() {
                  events.push(['retweet', 'fake']);
                  return universe.length;
                }
              },
              '#colors': {
                'width'() { return universe.length; }
              },
              '#velocities': {
                'width'() { return universe.length; }
              },
              '#sizes': {
                'width'() { return universe.length; }
              }
            },
            'fakeLike': {
              '#positions': {
                'width'() {
                  events.push(['like', 'fake']);
                  return universe.length;
                }
              },
              '#colors': {
                'width'() { return universe.length; }
              },
              '#velocities': {
                'width'() { return universe.length; }
              },
              '#sizes': {
                'width'() { return universe.length; }
              }
            },
            'newMass': {
              '#positions': {
                'width'() {
                  events.push(['observer+']);
                  return universe.length;
                }
              },
              '#colors': {
                'width'() { return universe.length; }
              },
              '#velocities': {
                'width'() { return universe.length; }
              },
              '#sizes': {
                'width'() { return universe.length; }
              }
            },
            'prevMass': () => {
              cameraOffset[0] = 0;
              cameraOffset[1] = 100;
              cameraOffset[2] = 0;
              return positionIndex === 0 ? positionIndex = universe.length - 1 : positionIndex--;
            },
            'nextMass': () => {
              cameraOffset[0] = 0;
              cameraOffset[1] = 100;
              cameraOffset[2] = 0;
              return positionIndex = (positionIndex + 1) % universe.length;
            }
          }
        };

        function createSocket() {
          // const socket = new WebSocket(`ws://${window.location.hostname}:8080`);
          const socket = new WebSocket(`ws://104.236.242.248:8080`);
          let opened;
          socket.onopen = () => {
            opened = true;
          };

          socket.onmessage = (data, flags) => {
            const parts = (data.data || '').split(',');
            const name = parts[0];

            switch (name) {
              case 'r':
                handle('retweet', parts);
                break;
              case 't':
                handle('tweet', parts);
                break;
              case 'o':
                events.push(['observer+']);
                break;
              case 'o-':
                break;
            }
          };

          socket.onclose = () => {
            if (opened) window.location.reload();
          };

          return socket;
        }

        function handle(name, parts) {
          const id = parts[1];
          events.push([name, id]);

          const likes = parseInt(parts[2], 10);
          const followers = parseInt(parts[3], 10);

          if (likes > 0) events.push(['like+', id, likes]);
          events.push(['follower+', followers]);
        }

        function start(view) {
          const socket = createSocket();

          const eevents = {
            // external
            'observer+': addObserver,
            'observer-': event => {},
            'tweet': addTweet,
            'like': addLike,
            'retweet': addRetweet,
            'follower-': event => {}, //?
            'follower': addFollower,

            'follower+': incrementFollowers,
            'like+': incrementLikes,
            'retweet+': incrementRetweets,

            // internal
            'absorbed': absorbed
          };

          const uuievents = {
            'tweet': event => trumpTweetEl.classList.remove('show'),
            'absorbed': event => absorbedEl.classList.remove('show')
          };

          const run = runner(universe);

          window.requestAnimationFrame(animate);

          function runner(universe, startTime = new Date().getTime(), maxTicksPerCall = 50) {
            let currentTick = 0;

            return (currentTime = new Date().getTime()) => {
              const dt = currentTime - startTime,
                    t = Math.ceil((dt / 1000) * ticksPerSecond),
                    ticks = Math.min(maxTicksPerCall, t - currentTick);

              for (let i = 0; i < ticks ; i++) {
                for (let i = 0; i < events.length; i++) {
                  const event = events[i];

                  (eevents[event[0]] || (() => {}))(event, view);
                }

                events.splice(0);

                tick();

                currentTick++;
              }

              if (currentTick !== t) {
                catchUpQuantityEl.parentElement.style.display = 'block';
                catchUpQuantityEl.innerHTML = currentTick - t;
              }
              else {
                catchUpQuantityEl.parentElement.style.display = 'none';
              }
            };
          }

          function animate() {
            run();

            for (let i = 0; i < uievents.length; i++) {
              const event = uievents[i];

              (uuievents[event[0]] || (() => {}))(event, view);
            }

            const p = universe[positionIndex].position,
                  tp = universe[lookAtIndex].position,
                  d = [p[0]-tp[0], p[1]-tp[1], p[2]-tp[2]],
                  m = magnitude(d);

            if (m > 0) {
              d[0] /= m;
              d[1] /= m;
              d[2] /= m;
            }

            add(cameraPosition, p, scale(d, d, 300));
            add(cameraPosition, cameraPosition, cameraOffset);

            void trumpTweetEl.offsetWidth;

            for (let i = 0; i < uievents.length; i++) {
              const [name, ...args] = uievents[i];

              if (name === 'tweet') trumpTweetEl.classList.add('show');
              else if (name === 'absorbed') {
                const [absorbed, by] = args;

                absorbedEl.classList.add('show');
                absorbedNameEl.innerHTML = absorbed;
                absorbedByNameEl.innerHTML = by;
              }
            }

            uievents.splice(0);

            window.requestAnimationFrame(animate);
          }
        }

        // might want in the future, saves typing
        function randomMass() {
          addMass(new Mass(1, [255, 255, 0, 1], [universe[0].position[0] + Math.random() * 5000 - 2500, universe[0].position[1] + Math.random() * 5000 - 2500, universe[0].position[2] + Math.random() * 5000 - 2500], [Math.random() * 600 - 300, Math.random() * 600 - 300, Math.random() * 600 - 300]));
        }

        function unselectMass(selectedMassIndex) {
          colors[selectedMassIndex][0] = savedColor[0];
          colors[selectedMassIndex][1] = savedColor[1];
          colors[selectedMassIndex][2] = savedColor[2];
        }

        function selectMass(selectedMassIndex) {
          savedColor[0] = colors[selectedMassIndex][0];
          savedColor[1] = colors[selectedMassIndex][1];
          savedColor[2] = colors[selectedMassIndex][2];
          colors[selectedMassIndex][0] = 0;
          colors[selectedMassIndex][1] = 255;
          colors[selectedMassIndex][2] = 0;
        }
      </script>
      <hud>
        <trump-mass><trump>TRUMP</trump>'s mass: <trump-mass-quantity></trump-mass-quantity></trump-mass>
        <orbit-statistics><orbit-statistics-quantity></orbit-statistics-quantity> in orbit</orbit-statistics>
        <catch-up><catch-up-quantity></catch-up-quantity> ticks behind</catch-up>
        <trump-tweet>
         <warning><trump>TRUMP</trump> has tweeted, watch out!</warning>
         <info>Don't worry, CNN is orbiting it!</info>
        </trump-tweet>
        <absorbed><absorbed-name></absorbed-name> was absorbed by <absorbed-by-name></absorbed-by-name>!</absorbed>
        <commands></commands>
        <current-look-at>
          <previous-look-at>&lt;</previous-look-at>
          <display>
            Looking At
            <look-at-mass-name></look-at-mass-name>
            <table>
              <tbody>
                <tr><td>Mass:</td><td><look-at-mass-quantity></look-at-mass-quantity></td></tr>
                <tr><td>Distance to <mass-name></mass-name>:</td><td><look-at-distance-quantity></distance-quantity></td></tr>
                <tr><td>Distance to <trump>TRUMP</trump>:</td><td><look-at-trump-distance-quantity></distance-quantity></td></tr>
              </tbody>
            </table>
          </display>
          <next-look-at>&gt;</next-look-at>
        </current-look-at>
        <current-mass>
          <display>
            <mass-name></mass-name>
            <table>
              <tbody>
                <tr><td>Mass:</td><td><mass-quantity></mass-quantity></td></tr>
                <tr><td>Distance to <trump>TRUMP</trump>:</td><td><distance-quantity></distance-quantity></td></tr>
              </tbody>
            </table>
          </display>
        </current-mass>
        <tag><trump>TRUMP</trump>orbit <brand>alpha preview</brand> <version>uncommitted</version></tag>
        <help>?</help>
        <help-content>
         O 'overview
         F 'frontview
         S 'sideview
         L 'lookAtTrump
         ] 'nextMass
         [ 'prevMass
         T 'fakeTweet
         R 'fakeRetweet
         K 'fakeLike
        ENTER 'newMass
        SPACE 'change movement target
         A 'decrease target x velocity (x-)
         D 'increase target x velocity (x+)
         W 'decrease target z velocity (z-)
         V 'increase target z velocity (z+)
         Q 'increase target y velocity (y-)
         Z 'decrease target y velocity (y+)
         . 'speed+
         , 'speed-
         0 'ticks+
         9 'ticks-
        </help-content>
      </hud>
    </mathbox>
    <notice class="fade-out"><screen></screen><message>entering <trump>TRUMP</trump> orbit<message><statement>You are a brave soul</statement></notice>
  </body>
</html>